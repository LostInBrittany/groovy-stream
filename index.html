<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Groovy-stream</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content"JBake">

    <!-- Le styles -->
    <link href="/groovy-stream/css/bootstrap.min.css" rel="stylesheet">
    <link href="/groovy-stream/css/asciidoctor.css" rel="stylesheet">
    <link href="/groovy-stream/css/base.css" rel="stylesheet">
    <link href="/groovy-stream/css/bootstrap-responsive.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="/groovy-stream/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="favicon.ico">
  </head>
  <body>
    <div id="wrap">

	<!-- Fixed navbar -->
      <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="brand" href="/groovy-stream/">groovy-stream</a>
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li><a href="/groovy-stream/index.html">Home</a></li>
                <li><a href="/groovy-stream/releases.html">Releases</a></li>

                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Method docs (in progress) <b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="/groovy-stream/map.html">Mapping Functions</a></li>
<!--
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li class="nav-header">Nav header</li>
                    <li><a href="#">Separated link</a></li>
                    <li><a href="#">One more separated link</a></li>
-->
                  </ul>
                </li>
              </ul>
            </div><!--/.nav-collapse -->
          </div>
        </div>
      </div>
      <div class="container">	
	<div class="page-header">
		<h1>Groovy-stream</h1>
	</div>
<!--
	<p><em>24 September 2013</em></p>
-->
	<p><p><a href="https://github.com/timyates/groovy-stream">Groovy-stream</a> is a library for Groovy that lets you create lazy Iterators (or streams) based on <code>Iterators</code>, <code>Collections</code>, <code>Maps</code>, <code>Iterables</code> or other Streams.</p><h2>Brief Example</h2><p>As a simple example, lets create a Stream representing all positive integers:</p>
<pre><code class="groovy">@Grab( &#39;com.bloidonia:groovy-stream:0.6.2&#39; )
import groovy.stream.Stream

def integers = Stream.from { x++ } using x:1
</code></pre><p>We can then create a Stream that is fed from <code>integers</code> and returns a Stream of squares:</p>
<pre><code class="groovy">def squares = Stream.from integers map { it * it }
</code></pre><p>And we can then take the first 5 elements from this stream with:</p>
<pre><code class="groovy">def first5 = squares.take( 5 ).collect()
assert first5 == [ 1, 4, 9, 16, 25 ]
</code></pre><p>It is only at the point where we call <code>collect()</code> that any integers are generated by the original <code>integers</code> Stream.</p><h3>Slightly more complex example showing faux list comprehension</h3><p>We can use the Stream to mimic the behaviour of a list comprehension. Lets say we want to do the following:</p>
<blockquote><p>For all values of <code>x</code> from 1 to 5 and all values of <code>y</code> from 1 to 3, return <code>x + 1</code> if <code>( x + y ) % ( x + 2 ) == 0</code></p>
</blockquote>
<pre><code class="groovy">def s = Stream.from( x:1..5, y:1..3 )
              .filter { ( x + y ) % ( x + 2 ) == 0 }
              .map { x + y }

// Returns results for:
//  3 - when - x:1, y:2 as (1+2)%(1+2) == 0
//  4 - when - x:2, y:2 as (2+2)%(2+2) == 0
//  5 - when - x:3, y:2 as (3+2)%(3+2) == 0
//  6 - when - x:4, y:2 as (4+2)%(4+2) == 0
//  7 - when - x:5, y:2 as (5+2)%(5+2) == 0
assert s.collect() == [ 3, 4, 5, 6, 7 ]
</code></pre><h2>Anatomy of a Stream</h2><p>Streams are composed of 4 parts:</p>
<ol>
  <li>The <code>input</code>, which can be an <code>Iterable</code>, an <code>Iterator</code>, a <code>Map</code>, a <code>Closure</code> or another <code>Stream</code></li>
  <li>A <code>filter</code> predicate Closure which removes items from the input stream as they are read</li>
  <li>A <code>map</code> which transforms the next item in the Stream into another object or value</li>
  <li>A <code>using</code> block of variables that the stream may access (and modify in the <code>map</code> closure)</li>
</ol><p>There is can be many <code>filter</code> and <code>map</code> steps (since v0.6) in a Stream and they<br/>are executed in the order they are defined.</p><p>There can only be a single <code>using</code> block (and I am considering dropping the <code>using</code> block<br/>as it doesn't feel functionally sound).</p><h3>Input Examples</h3><p>Examples of valid input are (just input on it's own isn't very exciting, but hereare examples anyway):</p>
<pre><code class="groovy">assert [ 1, 2, 3 ]       == Stream.from( [ 1, 2, 3 ] ).collect()              // An iterable
assert [ &#39;a&#39;, &#39;b&#39; ]      == Stream.from( &#39;a&#39;..&#39;z&#39; ).take( 2 ).collect()       // An iterable
assert [ [ x:1, y:3 ] ]  == Stream.from( x:1..3, y:3..4 ).take( 1 ).collect() // A map
</code></pre><h3>Filter Examples</h3><p>Just the even numbers from the <code>1..10</code> Range</p>
<pre><code class="groovy">Stream s = Stream.from 1..10 filter { it % 2 == 0 }
assert s.collect() == [ 2, 4, 6, 8, 10 ]
</code></pre><p>Just the elements where the sum of the values is even (note that the <code>from</code> map is set as the<br/>delegate of the <code>filter</code> closure, so you can access them without requiring the <code>it.a</code> prefixed<br/>notation:</p>
<pre><code class="groovy">Stream s = Stream.from a:1..2, b:3..4 filter { ( a + b ) % 2 == 0 }
assert s.collect() == [ [a:1,b:3], [a:2,b:4] ]
</code></pre><p>It is also possible to tell a Stream to stop running by using an <code>until</code> predicate Closure.</p>
<pre><code class="groovy">def x = 0

def eternal = [ hasNext:{ true }, next:{ x++ } ] as Iterator

Stream s = Stream.from eternal until { it &gt;= 5 }

assert s.collect() == [ 0, 1, 2, 3, 4 ]
</code></pre><h3>Map Examples</h3>
<pre><code class="groovy">Stream s = Stream.from 1..5 map { it + 5 }
assert s.collect() == [ 6, 7, 8, 9, 10 ]
</code></pre>
<pre><code class="groovy">s = Stream.from a:1..2, b:3..4 map { a + b }
assert s.collect() == [ 4, 5, 5, 6 ]
</code></pre><h3>Using Examples</h3><p>The Stream of integers from above</p>
<pre><code class="groovy">assert [ 1, 2, 3 ] == Stream.from { j++ }.using( j:1 ).take( 3 ).collect()
</code></pre><p>Starting with idx:0, return elements with an index element before them</p>
<pre><code class="groovy">Stream s = Stream.from &#39;a&#39;..&#39;c&#39; map { [ idx++, it ] } using idx:0
assert s.collect() == [ [0,&#39;a&#39;], [1,&#39;b&#39;], [2,&#39;c&#39;] ]
</code></pre><h3>Other methods</h3><p>There are currently 2 other methods available in a Stream definition:</p><h4><code>flatMap</code></h4><p>The <code>flatMap</code> step returns a List of elements, and each of this list is then passed<br/>individually along the rest of the stream. Only when the list is exhausted will the<br/>stream go back to the source for another value to process:</p>
<pre><code class="groovy">Stream s = Stream.from 1..5 flatMap { [ &#39;a&#39;, it ] }
assert s.collect() == [ &#39;a&#39;, 1, &#39;a&#39;, 2, &#39;a&#39;, 3, &#39;a&#39;, 4, &#39;a&#39;, 5 ]
</code></pre><h4><code>collate</code></h4><p>The <code>collate</code> call will group the Stream into chunks of a given size, and will only<br/>release an item to the rest of the stream when this criteria is met (or the stream terminates).</p>
<pre><code class="groovy">Stream s = Stream.from 1..5 collate( 3 )
assert s.collect() == [ [ 1, 2, 3 ], [ 4, 5 ] ]
</code></pre><p>You can also (as in Groovy) give collate a <code>step</code> value to give you a sliding window effect:</p>
<pre><code class="groovy">// Step along by 2 each time
Stream s = Stream.from 1..5 collate( 3, 1 )
assert s.collect() == [ [ 1, 2, 3 ], [ 2, 3, 4 ], [ 3, 4, 5 ], [ 4, 5 ], [ 5 ] ]
</code></pre><p>And You can tell it to drop the remainder results:</p>
<pre><code class="groovy">// Step along by 2 each time
Stream s = Stream.from 1..5 collate( 3, 1, false )
assert s.collect() == [ [ 1, 2, 3 ], [ 2, 3, 4 ], [ 3, 4, 5 ] ]
</code></pre><h4><code>tap</code> and <code>tapEvery</code></h4><p>To look at every 2nd element as it passes the stream, you can do:</p>
<pre><code class="groovy">// prints &#39;2&#39; and &#39;4&#39; as the Stream progresses
def s = Stream.from 1..5 tapEvery( 2 ) { idx -&gt; println idx } collect()

// prints &#39;2 : b&#39; and &#39;4 : d&#39; as the Stream progresses
def s = Stream.from &#39;a&#39;..&#39;e&#39; tapEvery( 2 ) { idx, obj -&gt; println &quot;$idx : $obj&quot; } collect()
</code></pre></p>

	<hr>

		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2013 | Mixed with <a href="http://twitter.github.com/bootstrap/">Bootstrap v2.3.1</a> | Baked with <a href="http://jbake.org">JBake v2.2.1</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/groovy-stream/js/jquery-1.9.1.min.js"></script>
    <script src="/groovy-stream/js/bootstrap.min.js"></script>
    <script src="/groovy-stream/js/run_prettify.js"></script>
    
  </body>
</html>